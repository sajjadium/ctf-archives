const fastify = require("fastify")();
const fs = require("node:fs/promises");

const PORT = process.env.PORT ?? "3000";

fastify.register(require("@fastify/formbody"));
fastify.register(require("./report"), { prefix: "/report" });

fastify.get("/", async (req, reply) => {
  const html = await fs.readFile("views/index.html");
  return reply.type("text/html; charset=utf-8").send(html);
});

fastify.get("/result", async (req, reply) => {
  const html = await fs.readFile("views/result.html");
  return reply.type("text/html; charset=utf-8").send(html);
});

fastify.get("/api/emojis", async (req, reply) => {
  const emojis =
    "ðŸ˜€/ðŸ˜ƒ/ðŸ˜„/ðŸ˜/ðŸ˜†/ðŸ˜…/ðŸ˜‚/ðŸ¤£/ðŸ¥²/â˜ºï¸/ðŸ˜Š/ðŸ˜‡/ðŸ™‚/ðŸ™ƒ/ðŸ˜‰/ðŸ˜Œ/ðŸ˜/ðŸ¥°/ðŸ˜˜/ðŸ˜—/ðŸ˜™/ðŸ˜š/ðŸ˜‹/ðŸ˜›/ðŸ˜/ðŸ˜œ/ðŸ¤ª/ðŸ¤¨/ðŸ§/ðŸ¤“/ðŸ˜Ž/ðŸ¥¸/ðŸ¤©/ðŸ¥³/ðŸ˜/ðŸ˜’/ðŸ˜ž/ðŸ˜”/ðŸ˜Ÿ/ðŸ˜•/ðŸ™/â˜¹ï¸/ðŸ˜£/ðŸ˜–/ðŸ˜«/ðŸ˜©/ðŸ¥º/ðŸ˜¢/ðŸ˜­/ðŸ˜¤/ðŸ˜ /ðŸ˜¡/ðŸ¤¬/ðŸ¤¯/ðŸ˜³/ðŸ¥µ/ðŸ¥¶/ðŸ˜±/ðŸ˜¨/ðŸ˜°/ðŸ˜¥/ðŸ˜“/ðŸ¤—/ðŸ¤”/ðŸ¤­/ðŸ¤«/ðŸ¤¥/ðŸ˜¶/ðŸ˜/ðŸ˜‘/ðŸ˜¬/ðŸ™„/ðŸ˜¯/ðŸ˜¦/ðŸ˜§/ðŸ˜®/ðŸ˜²/ðŸ¥±/ðŸ˜´/ðŸ¤¤/ðŸ˜ª/ðŸ˜µ/ðŸ¤/ðŸ¥´/ðŸ¤¢/ðŸ¤®/ðŸ¤§/ðŸ˜·/ðŸ¤’/ðŸ¤•/ðŸ¤‘/ðŸ¤ /ðŸ˜ˆ/ðŸ‘¿/ðŸ‘¹/ðŸ‘º/ðŸ¤¡/ðŸ’©/ðŸ‘»/ðŸ’€/â˜ ï¸/ðŸ‘½/ðŸ‘¾/ðŸ¤–/ðŸŽƒ/ðŸ˜º/ðŸ˜¸/ðŸ˜¹/ðŸ˜»/ðŸ˜¼/ðŸ˜½/ðŸ™€/ðŸ˜¿/ðŸ˜¾/ðŸ¶/ðŸ±/ðŸ­/ðŸ¹/ðŸ°/ðŸ¦Š/ðŸ»/ðŸ¼/ðŸ»â€â„ï¸/ðŸ¨/ðŸ¯/ðŸ¦/ðŸ®/ðŸ·/ðŸ½/ðŸ¸/ðŸµ/ðŸ™ˆ/ðŸ™‰/ðŸ™Š/ðŸ’/ðŸ”/ðŸ§/ðŸ¦/ðŸ¤/ðŸ£/ðŸ¥/ðŸ¦†/ðŸ¦…/ðŸ¦‰/ðŸ¦‡/ðŸº/ðŸ—/ðŸ´/ðŸ¦„/ðŸ/ðŸª±/ðŸ›/ðŸ¦‹/ðŸŒ/ðŸž/ðŸœ/ðŸª°/ðŸª²/ðŸª³/ðŸ¦Ÿ/ðŸ¦—/ðŸ•·/ðŸ•¸/ðŸ¦‚/ðŸ¢/ðŸ/ðŸ¦Ž/ðŸ¦–/ðŸ¦•/ðŸ™/ðŸ¦‘/ðŸ¦/ðŸ¦ž/ðŸ¦€/ðŸ¡/ðŸ /ðŸŸ/ðŸ¬/ðŸ³/ðŸ‹/ðŸ¦ˆ/ðŸŠ/ðŸ…/ðŸ†/ðŸ¦“/ðŸ¦/ðŸ¦§/ðŸ¦£/ðŸ˜/ðŸ¦›/ðŸ¦/ðŸª/ðŸ«/ðŸ¦’/ðŸ¦˜/ðŸ¦¬/ðŸƒ/ðŸ‚/ðŸ„/ðŸŽ/ðŸ–/ðŸ/ðŸ‘/ðŸ¦™/ðŸ/ðŸ¦Œ/ðŸ•/ðŸ©/ðŸ¦®/ðŸ•â€ðŸ¦º/ðŸˆ/ðŸˆâ€â¬›/ðŸª¶/ðŸ“/ðŸ¦ƒ/ðŸ¦¤/ðŸ¦š/ðŸ¦œ/ðŸ¦¢/ðŸ¦©/ðŸ•Š/ðŸ‡/ðŸ¦/ðŸ¦¨/ðŸ¦¡/ðŸ¦«/ðŸ¦¦/ðŸ¦¥/ðŸ/ðŸ€/ðŸ¿/ðŸ¦”/ðŸ¾/ðŸ‰/ðŸ²".split(
      "/"
    );
  return reply.send(emojis);
});

fastify.listen({ port: PORT, host: "0.0.0.0" }, (err, address) => {
  if (err) {
    fastify.log.error(err);
    process.exit(1);
  }
  console.log(`Server listening at "${address}"`);
});
